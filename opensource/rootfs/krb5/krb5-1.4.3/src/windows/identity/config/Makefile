#
# Copyright (c) 2004 Massachusetts Institute of Technology
#
# Permission is hereby granted, free of charge, to any person
# obtaining a copy of this software and associated documentation files
# (the "Software"), to deal in the Software without restriction,
# including without limitation the rights to use, copy, modify, merge,
# publish, distribute, sublicense, and/or sell copies of the Software,
# and to permit persons to whom the Software is furnished to do so,
# subject to the following conditions:
#
# The above copyright notice and this permission notice shall be
# included in all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
# BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
# ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
# CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.


MODULE=config
!include <Makefile.w32>

all: mkalldirs mkversion

mkalldirs:
!	if !exist($(DESTROOT))
	-$(MKDIR) $(DESTROOT)
!	endif
!	if !exist($(OBJROOT))
	-$(MKDIR) $(OBJROOT)
!	endif
!	if !exist($(DESTDIR))
	-$(MKDIR) $(DESTDIR)
!	endif
!	if !exist($(OBJDIR))
	-$(MKDIR) $(OBJDIR)
!	endif
!	if !exist($(INCDIR))
	-$(MKDIR) $(INCDIR)
!	endif
!	if !exist($(BINDIR))
	-$(MKDIR) $(BINDIR)
!	endif
!	if !exist($(LIBDIR))
	-$(MKDIR) $(LIBDIR)
!	endif
!	if !exist($(DOCDIR))
	-$(MKDIR) $(DOCDIR)
!	endif
	$(ECHO) Done creating directories.

VERSIONINC=$(INCDIR)\khimaira_version.h

# Version related defines

! if "$(KH_BUILD)"=="RETAIL"
kh_fileflags=0
! else
kh_fileflags=VS_FF_DEBUG
! endif
! if "$(KH_RELEASE)"=="PRERELEASE"
kh_fileflags=$(kh_fileflags) | VS_FF_PRERELEASE
! elseif "$(KH_RELEASE)"=="PRIVATE"
kh_fileflags=$(kh_fileflags) | VS_FF_PRIVATEBUILD
! elseif "$(KH_RELEASE)"=="SPECIAL"
kh_fileflags=$(kh_fileflags) | VS_FF_SPECIALBUILD
! endif

kh_fileos=VOS_NT_WINDOWS32
kh_filetype_app=VFT_APP
kh_filetype_dll=VFT_DLL

mkversion: $(VERSIONINC)

$(VERSIONINC): Makefile
	$(CP) << $(VERSIONINC)
/*
 * This is an autogenerated file.  Do not modify directly.
 * 
 * File generated by running $(MAKE) in $(MAKEDIR)
 * To regenerate, run "$(MAKE) clean" and "$(MAKE) all" on $(MAKEDIR)
 */
#ifndef __KHIMAIRA_VERSION_H
#define __KHIMAIRA_VERSION_H

/* Version number macros */
#define KH_VERSION_MAJOR 	$(KHIMAIRA_VERSION_MAJOR)
#define KH_VERSION_MINOR 	$(KHIMAIRA_VERSION_MINOR)
#define KH_VERSION_PATCH 	$(KHIMAIRA_VERSION_PATCH)
#define KH_VERSION_AUX 		$(KHIMAIRA_VERSION_AUX)
#define KH_VERSION_LIST 	$(KHIMAIRA_VERSIONC)
#define KH_VERSION_STRING 	"$(KHIMAIRA_VERSION)"
#define KH_VERSION_STRINGW 	L"$(KHIMAIRA_VERSION)"
#define KH_VERSION_STRINGC 	"$(KHIMAIRA_VERSIONC)"
#define KH_VERSION_STRINGCW 	L"$(KHIMAIRA_VERSIONC)"

/* Version definition macros */
#define KH_VER_FILEFLAGS 	$(kh_fileflags)
#define KH_VER_FILEOS 		$(kh_fileos)
#define KH_VER_FILETYPEDLL 	$(kh_filetype_dll)
#define KH_VER_FILETYPEAPP 	$(kh_filetype_app)

/* Language specific version strings */
#define KH_VERSTR_COMPANY_1033	"$(KHIMAIRA_SRC_COMPANY_1033)"
#define KH_VERSTR_COPYRIGHT_1033 "$(KHIMAIRA_SRC_COPYRIGHT_1033)"
#define KH_VERSTR_PRODUCT_1033	"$(KHIMAIRA_PRODUCT_1033)"
#define KH_VERSTR_VERSION_1033	"$(KHIMAIRA_VERSION_STR_1033)"

!ifdef KHIMAIRA_COMMENT_STR_1033
#define KH_VERSTR_COMMENT_1033	"$(KHIMAIRA_COMMENT_STR_1033)"
#define KH_VERSTR_BUILDINFO_1033 KH_VERSTR_COMMENT_1033
!endif
!ifdef KHIMAIRA_PRIVATE_STR_1033
#define KH_VERSTR_PRIVATE_1033	"$(KHIMAIRA_PRIVATE_STR_1033)"
#define KH_VERSTR_BUILDINFO_1033 KH_VERSTR_PRIVATE_1033
!endif
!ifdef KHIMAIRA_SPECIAL_STR_1033
#define KH_VERSTR_SPECIAL_1033	"$(KHIMAIRA_SPECIAL_STR_1033)"
#define KH_VERSTR_BUILDINFO_1033 KH_VERSTR_SPECIAL_1033
!endif
#endif
<<

clean::
!	if exist($(VERSIONINC))
	$(RM) $(VERSIONINC)
!	endif

